- defaultTab: nodes
  description: "Dependency on the create files job  \n1 : dep on file with flag +\
    \ validation + empty flag + ssh on local  \n2 : dep on file with flag + validation\
    \ on a valid hash + ssh on local  \n3 : dep on file with flag + validation on\
    \ an invalid hash + ssh on local  \n4 : dep on missing file requiring a skip file\
    \ + ssh on local  \n\n"
  executionEnabled: true
  group: tests-dependency-files
  id: 0dfd19f0-ab35-413a-9a72-24dcd4a508a4
  loglevel: INFO
  name: Dependency - files - 4 - dep on create files with hash + ssh
  nodeFilterEditable: false
  options:
  - description: Extra parameters for the dependencies
    label: 'Deps parameters '
    name: DEPENDENCY_EXTRA_PARAMS
  - description: 'don''t ask, should be set to RUNDECK_WORKDIR'
    hidden: true
    name: working_dir
    required: true
    value: /tmp/rundeck
  plugins:
    ExecutionLifecycle: {}
  scheduleEnabled: true
  sequence:
    commands:
    - configuration:
        command: bash -c -- "echo HOSTNAME=$HOSTNAME"
      description: retrieve local hostname
      nodeStep: true
      plugins:
        LogFilter:
        - config:
            invalidKeyPattern: \s|\$|\{|\}|\\
            logData: 'true'
            name: MustHaveAGroup
            regex: ^(HOSTNAME)\s*=\s*(.+)$
            replaceFilteredResult: 'false'
          type: key-value-data
      type: localexec
    - configuration:
        export: localhostname
        group: export
        value: ${data.HOSTNAME*}
      description: convert to option
      nodeStep: false
      type: export-var
    - configuration:
        command: bash -c -- "echo  -test1 ${data.HOSTNAME} -test2 ${export.localhostname}"
      description: test
      nodeStep: true
      type: localexec
    - configuration:
        flag_ext: _flag
        flag_type: 'true'
        flag_verify_hash: 'true'
        force_launch: 'false'
        optional_params: ${option.DEPENDENCY_EXTRA_PARAMS}
        target_directory: /tmp
        target_file: rundeck_deps_wait_file.test
        target_host: ${export.localhostname}
      description: dep basic + flag + content empty
      nodeStep: false
      type: dependencies-wait_file
    - configuration:
        flag_ext: _flag
        flag_type: 'true'
        flag_verify_hash: 'true'
        force_launch: 'false'
        optional_params: ${option.DEPENDENCY_EXTRA_PARAMS}
        target_directory: /tmp
        target_file: rundeck_deps_wait_file_hash.test
        target_host: ${export.localhostname}
      description: dep basic + flag + validate
      nodeStep: false
      type: dependencies-wait_file
    - configuration:
        flag_ext: _flag
        flag_type: 'true'
        flag_verify_hash: 'true'
        force_launch: 'false'
        optional_params: ${option.DEPENDENCY_EXTRA_PARAMS}
        target_directory: /tmp
        target_file: rundeck_deps_wait_file_hash_invalid.test
        target_host: ${export.localhostname}
      description: dep basic + flag + validate bad hash
      errorhandler:
        configuration:
          command: bash -c -- "echo job recovered"
        keepgoingOnSuccess: true
        nodeStep: true
        type: localexec
      nodeStep: false
      type: dependencies-wait_file
    - configuration:
        command: bash -c -- "echo job finished"
      description: echo
      nodeStep: true
      type: localexec
    keepgoing: false
    strategy: node-first
  uuid: 0dfd19f0-ab35-413a-9a72-24dcd4a508a4
